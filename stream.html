<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Block common ad classes */
        iframe[src*="ads"],
        iframe[src*="pop"],
        div[id*="ads"],
        div[class*="ads"] {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center justify-center min-h-screen p-6">

    <h2 id="movieTitle" class="text-2xl font-bold mb-4 text-gray-100">Loading...</h2>
    <iframe id="streamFrame" class="w-full max-w-3xl h-[500px] rounded-lg border border-gray-700"></iframe>

    <script>
        const TMDB_API_KEY = "55b11132b5aef36e8376418dcce756f2";  // Replace with your TMDb API Key

        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        let tmdbId = getQueryParam("tmdbId");
        let type = getQueryParam("type");
        let season = getQueryParam("season");
        let episode = getQueryParam("episode");
        let provider = getQueryParam("provider") || "vidsrc.cc";

        async function fetchMovieTitle() {
            let apiUrl = type === "series"
                ? `https://api.themoviedb.org/3/tv/${tmdbId}?api_key=${TMDB_API_KEY}`
                : `https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${TMDB_API_KEY}`;

            try {
                let response = await fetch(apiUrl);
                let data = await response.json();
                document.getElementById("movieTitle").textContent = `Now Streaming: ${data.title || data.name}`;
            } catch (error) {
                document.getElementById("movieTitle").textContent = "Title Not Found";
            }
        }

        if (tmdbId) {
            fetchMovieTitle();
            let embedUrl = type === "series" 
                ? `https://${provider}/embed/tv/${tmdbId}/${season}/${episode}`
                : `https://${provider}/embed/${tmdbId}`;
            document.getElementById("streamFrame").src = embedUrl;
        } else {
            document.body.innerHTML = "<h2 class='text-red-500 text-center'>Error: No TMDb/IMDb ID provided</h2>";
        }

        function removeIframeAds() {
            let iframe = document.getElementById("streamFrame");
            let adPatterns = ["ads", "pop", "banner", "sponsor", "tracker"];
            let observer = new MutationObserver(() => {
                let iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                adPatterns.forEach(pattern => {
                    iframeDoc.querySelectorAll(`[id*='${pattern}'], [class*='${pattern}']`).forEach(ad => ad.remove());
                });
            });
            observer.observe(iframe, { childList: true, subtree: true });
        }

        function blockExternalAds() {
            let adKeywords = ["ads", "popunder", "banner", "tracking", "sponsor"];
            let scripts = document.querySelectorAll("script[src]");
            scripts.forEach(script => {
                adKeywords.forEach(keyword => {
                    if (script.src.includes(keyword)) {
                        script.remove();
                    }
                });
            });
        }

        setInterval(() => {
            removeIframeAds();
            blockExternalAds();
        }, 2000);
    </script>

</body>
</html>
